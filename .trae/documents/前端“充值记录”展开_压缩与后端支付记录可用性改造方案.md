## 问题定位
- 前端“购买记录”目前仅展示账号、余额与最新充值时间，点击余额按钮才打开“额度日志”弹窗，无法直接看到充值记录。[RechargePage.tsx](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/client/src/components/RechargePage.tsx#L227-L269)
- 弹窗内的“额度日志”来源于 /api/dealer/account-logs，只包含 user_quota_log 的增减记录，不含支付订单详情（订单号、状态等）。[getDealerAccountLogs](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/server/services.js#L488-L521)
- 真实“充值记录”（支付订单）接口是 /api/dealer/orders，按渠道返回订单列表，包含账号、金额、订单号、创建/支付时间、状态等。[getDealerOrders](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/server/services.js#L449-L469)，[routes.js](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/server/routes.js#L310-L318)
- 目前前端未调用 /api/dealer/orders 显示充值记录，且“账号日志”请求未通过统一 API 基地址，可能导致跨域或反向代理未配置场景下的请求失败：日志请求使用了相对路径 fetch('/api/...')，[RechargePage.tsx](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/client/src/components/RechargePage.tsx#L360-L378)，而项目已提供统一封装 api() 使用 VITE_API_BASE。[api.ts](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/client/src/utils/api.ts)

## 后端现状
- 账户列表：/api/dealer/accounts 按渠道聚合余额与最新时间。[routes.js](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/server/routes.js#L321-L331)，[services.js](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/server/services.js#L471-L486)
- 账号日志：/api/dealer/account-logs 校验账号归属后返回 user_quota_log 列表，不含订单详情。[services.js](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/server/services.js#L488-L521)
- 订单列表（充值记录）：/api/dealer/orders 仅按渠道返回全部订单，需要前端按账号分组显示。[services.js](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/server/services.js#L449-L469)
- 渠道名解析：登录手机号映射渠道名，缺映射时回退为手机号本身。[getChannelNameByPhone](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/server/services.js#L313-L329)

## 原因总结（“获取不了对应的支付记录”）
- 前端未调用 /api/dealer/orders，导致充值记录未展示。
- 日志请求未走统一 API 基址，生产环境可能请求不到服务（相对路径）。
- 若渠道映射缺失或错误，/api/dealer/orders 会返回空集（需确认 channel_partners 表数据）。

## 改造目标
- 默认在“购买记录”表内展示所有账号的“充值记录”（支付订单），不再依赖点击余额。
- 同一账号的充值记录支持“展开/压缩”切换，默认展开，点击后压缩隐藏该账号的支付列表。
- 统一使用 api() 发起所有请求，避免环境不一致导致的获取失败。

## 前端改动
1. 数据获取
- 在 App.tsx 登录后，增加一次 /api/dealer/orders 拉取渠道所有订单，并保存在状态；现有账户列表保持不变。[App.tsx](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/client/src/App.tsx#L74-L80)
- 在 RechargePage 通过 props 接收订单列表，或在组件内按 dealerAccount 拉取（复用 api('/api/dealer/orders?dealer_name=...')）。
2. 展示与交互
- 在“购买记录”表中，每个账号行下方渲染该账号的订单子表（字段：时间、金额、订单号、状态、支付时间）。
- 为每个账号添加“压缩/展开”按钮，使用一个 expandedAccounts: Set<string> 状态管理，默认包含全部账号；点击切换是否显示该账号的订单子表。
- 移除点击余额打开日志的依赖；日志弹窗保留为辅助信息（可保留按钮为“查看日志”，与“压缩/展开”并列）。
3. 请求统一
- 将日志 fetch('/api/dealer/account-logs?...') 改为 api('/api/dealer/account-logs?...')，确保基址一致。[RechargePage.tsx](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/client/src/components/RechargePage.tsx#L360-L378)

## 后端建议（可选，便于你后续修改）
- 新增 /api/dealer/account-orders?dealer_account=&account=，直接按账号返回订单，减少前端分组与数据量；实现上复用 getDealerOrders 的 SQL，增加 WHERE user_id = ? 过滤。
- 在 account-logs 中可补充订单关联信息（order_no、transaction_id），若 user_quota_log 与 pay_orders 有外键或可通过时间/金额匹配；当前接口返回 null。

## 交付内容
- 更新 App.tsx：新增订单拉取与状态；将订单传递给 RechargePage。
- 更新 RechargePage.tsx：统一 api()、新增账号订单子表、展开/压缩交互、保留日志按钮但不再依赖其展示充值记录。
- 代码遵循现有样式与类型定义，[OrderItem](file:///c:/Users/33664/Desktop/代码开发任务/2025年12月15日——微信支付框架/client/src/types.ts#L5-L16) 可直接用于渲染。

## 验证
- 登录后应看到每个账号下的充值订单列表，默认全部展开；点击“压缩”仅隐藏该账号的订单子表。
- 切换网络至生产域名（VITE_API_BASE）时，日志与订单均可正常获取，避免相对路径导致的失败。

请确认以上方案，我即可按此实现前端改动；后端两项建议可在你后续按需补充。